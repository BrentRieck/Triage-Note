<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Clinician Helper</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        color-scheme: light;
        --bg-base: #f4f7ff;
        --bg-card: rgba(255, 255, 255, 0.82);
        --bg-card-strong: rgba(255, 255, 255, 0.92);
        --border-card: rgba(78, 101, 211, 0.18);
        --shadow-card: 0 28px 46px rgba(86, 111, 214, 0.16);
        --accent: #4250ff;
        --accent-soft: rgba(66, 80, 255, 0.12);
        --accent-strong: #2f37cc;
        --text-strong: #10152a;
        --text-muted: #5c6180;
        --pill-bg: rgba(64, 94, 245, 0.1);
        --surface-elevated: rgba(246, 248, 255, 0.72);
        --input-bg: rgba(248, 250, 255, 0.92);
        --input-border: rgba(66, 80, 255, 0.26);
        --output-border: rgba(66, 80, 255, 0.3);
        --status-waiting: rgba(66, 80, 255, 0.12);
        --status-success: rgba(25, 163, 92, 0.12);
        --status-error: rgba(227, 91, 91, 0.12);
      }

      body.dark {
        color-scheme: dark;
        --bg-base: #0c101c;
        --bg-card: rgba(18, 25, 47, 0.74);
        --bg-card-strong: rgba(18, 25, 47, 0.88);
        --border-card: rgba(132, 154, 255, 0.24);
        --shadow-card: 0 34px 60px rgba(5, 8, 18, 0.78);
        --accent: #8a9dff;
        --accent-soft: rgba(138, 157, 255, 0.16);
        --accent-strong: #a6b3ff;
        --text-strong: #f3f5ff;
        --text-muted: #aab4ff;
        --pill-bg: rgba(138, 157, 255, 0.18);
        --surface-elevated: rgba(15, 21, 42, 0.76);
        --input-bg: rgba(13, 19, 38, 0.82);
        --input-border: rgba(138, 157, 255, 0.32);
        --output-border: rgba(138, 157, 255, 0.38);
        --status-waiting: rgba(138, 157, 255, 0.16);
        --status-success: rgba(62, 201, 134, 0.14);
        --status-error: rgba(240, 120, 120, 0.18);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Inter", "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        background: var(--bg-base);
        min-height: 100vh;
        padding: 32px 18px 48px;
        color: var(--text-strong);
        position: relative;
        overflow-x: hidden;
        transition: background 0.45s ease, color 0.45s ease;
      }

      .halo {
        position: fixed;
        inset: 0;
        pointer-events: none;
        overflow: hidden;
      }

      .halo span {
        position: absolute;
        filter: blur(110px);
        opacity: 0.85;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        mix-blend-mode: screen;
      }

      .halo span:nth-child(1) {
        top: 8%;
        left: 20%;
        width: 420px;
        height: 420px;
        background: rgba(100, 122, 255, 0.46);
      }

      .halo span:nth-child(2) {
        top: 12%;
        right: -6%;
        width: 520px;
        height: 520px;
        background: rgba(200, 210, 255, 0.48);
      }

      .halo span:nth-child(3) {
        bottom: -12%;
        left: 50%;
        width: 580px;
        height: 580px;
        background: rgba(142, 102, 255, 0.32);
      }

      body.dark .halo span:nth-child(1) {
        background: rgba(70, 92, 220, 0.54);
      }

      body.dark .halo span:nth-child(2) {
        background: rgba(104, 58, 255, 0.28);
      }

      body.dark .halo span:nth-child(3) {
        background: rgba(40, 56, 180, 0.36);
      }

      .app-shell {
        max-width: 1040px;
        margin: 0 auto;
        position: relative;
        z-index: 1;
        display: flex;
        flex-direction: column;
        gap: 26px;
      }

      .hero {
        background: var(--bg-card);
        border-radius: 28px;
        padding: clamp(24px, 5vw, 38px);
        border: 1px solid var(--border-card);
        box-shadow: var(--shadow-card);
        backdrop-filter: blur(18px);
        display: flex;
        flex-direction: column;
        gap: 22px;
      }

      .hero-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 16px;
        flex-wrap: wrap;
      }

      .app-pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: var(--pill-bg);
        color: var(--accent);
        padding: 6px 14px;
        border-radius: 999px;
        font-weight: 600;
        font-size: 0.92rem;
        letter-spacing: 0.02em;
      }

      .theme-toggle {
        appearance: none;
        border: 1px solid transparent;
        background: var(--accent-soft);
        color: var(--accent);
        border-radius: 999px;
        padding: 9px 16px;
        font-size: 0.95rem;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.25s ease, color 0.25s ease, transform 0.25s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .theme-toggle:hover {
        background: rgba(66, 80, 255, 0.22);
        transform: translateY(-1px);
      }

      .theme-toggle:focus-visible {
        outline: 2px solid var(--accent);
        outline-offset: 2px;
      }

      body.dark .theme-toggle {
        color: var(--accent-strong);
        background: rgba(138, 157, 255, 0.18);
      }

      body.dark .theme-toggle:hover {
        background: rgba(138, 157, 255, 0.28);
      }

      .hero h1 {
        margin: 0;
        font-size: clamp(2rem, 5vw, 3.1rem);
        letter-spacing: -0.03em;
      }

      .hero p {
        margin: 0;
        color: var(--text-muted);
        font-size: clamp(1rem, 2.5vw, 1.1rem);
        line-height: 1.6;
      }

      .hero-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 18px;
      }

      .hero-card {
        background: var(--surface-elevated);
        border-radius: 18px;
        padding: 16px 18px;
        border: 1px solid rgba(126, 144, 255, 0.18);
        display: grid;
        gap: 6px;
      }

      .hero-card strong {
        font-size: 1rem;
      }

      .panel-layout {
        display: grid;
        gap: 22px;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      }

      .panel {
        background: var(--bg-card-strong);
        border-radius: 24px;
        padding: clamp(22px, 3.6vw, 30px);
        border: 1px solid var(--border-card);
        box-shadow: var(--shadow-card);
        backdrop-filter: blur(14px);
        display: flex;
        flex-direction: column;
        gap: 18px;
        min-height: 100%;
      }

      .panel h2 {
        margin: 0;
        font-size: 1.3rem;
        letter-spacing: -0.015em;
      }

      label {
        font-weight: 600;
        font-size: 0.95rem;
      }

      textarea {
        width: 100%;
        min-height: 220px;
        border-radius: 18px;
        border: 1px solid var(--input-border);
        padding: 18px 20px;
        resize: vertical;
        font: inherit;
        line-height: 1.55;
        color: inherit;
        background: var(--input-bg);
        transition: border-color 0.25s ease, box-shadow 0.25s ease;
      }

      textarea:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 4px rgba(66, 80, 255, 0.18);
      }

      .actions {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
      }

      button.action {
        appearance: none;
        border: none;
        border-radius: 16px;
        background: linear-gradient(135deg, var(--accent), var(--accent-strong));
        color: #ffffff;
        padding: 14px 20px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        transition: transform 0.22s ease, box-shadow 0.25s ease, filter 0.25s ease;
        box-shadow: 0 18px 34px rgba(66, 80, 255, 0.28);
      }

      button.action:hover {
        transform: translateY(-2px);
        box-shadow: 0 22px 38px rgba(66, 80, 255, 0.34);
      }

      button.action:active {
        transform: translateY(0);
      }

      button.action:disabled {
        cursor: wait;
        opacity: 0.68;
        transform: none;
        box-shadow: none;
        filter: saturate(0.9);
      }

      .status {
        display: none;
        align-items: center;
        gap: 10px;
        padding: 12px 14px;
        border-radius: 14px;
        font-size: 0.95rem;
      }

      .status.show {
        display: inline-flex;
      }

      .status[data-state="waiting"] {
        background: var(--status-waiting);
        color: var(--accent);
      }

      .status[data-state="success"] {
        background: var(--status-success);
        color: #198754;
      }

      .status[data-state="error"] {
        background: var(--status-error);
        color: #d24a4a;
      }

      .spinner {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        border: 2px solid currentColor;
        border-right-color: transparent;
        animation: spin 0.75s linear infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      pre {
        white-space: pre-wrap;
        margin: 0;
        font: 0.98rem/1.65 "IBM Plex Sans", "Inter", system-ui, sans-serif;
      }

      .output-box {
        background: var(--input-bg);
        border-radius: 18px;
        border: 1px dashed var(--output-border);
        padding: 20px 22px;
        min-height: 220px;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .empty-hint {
        color: var(--text-muted);
        font-size: 0.95rem;
      }

      .disclaimer {
        margin: 0;
        font-size: 0.9rem;
        color: var(--text-muted);
        max-width: 520px;
      }

      .footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 16px;
        font-size: 0.92rem;
        color: var(--text-muted);
        padding: 0 4px;
      }

      @media (max-width: 720px) {
        body {
          padding: 24px 14px 38px;
        }

        .hero-top {
          flex-direction: column;
          align-items: stretch;
        }

        .theme-toggle {
          align-self: flex-end;
        }

        .panel-layout {
          grid-template-columns: 1fr;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
          scroll-behavior: auto !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="halo" aria-hidden="true">
      <span></span>
      <span></span>
      <span></span>
    </div>
    <div class="app-shell">
      <section class="hero" aria-labelledby="hero-title">
        <div class="hero-top">
          <div class="app-pill" aria-hidden="true">Clinician Helper</div>
          <button id="theme-toggle" class="theme-toggle" type="button" aria-pressed="false">
            🌙 Dark mode
          </button>
        </div>
        <div>
          <h1 id="hero-title">Turn triage chaos into clear clinician-ready insight.</h1>
          <p>
            Summarize telephone notes for rapid physician review or surface the essential follow-up
            questions you need to triage safely. Nothing is stored and protected health information is
            purposefully omitted from responses.
          </p>
        </div>
        <div class="hero-grid" role="list">
          <div class="hero-card" role="listitem">
            <strong>Summaries in seconds</strong>
            <span>Convert dense phone narratives into concise clinical paragraphs.</span>
          </div>
          <div class="hero-card" role="listitem">
            <strong>Focused triage prompts</strong>
            <span>Ask the right follow-ups with prioritized, safety-first questions.</span>
          </div>
          <div class="hero-card" role="listitem">
            <strong>Compliance conscious</strong>
            <span>No protected health information is retained by this experience.</span>
          </div>
        </div>
      </section>

      <div class="panel-layout">
        <section class="panel" aria-labelledby="input-heading">
          <div>
            <h2 id="input-heading">Patient call or note</h2>
            <p class="disclaimer">
              Paste unstructured telephone notes or transcripts. We'll refine them while respecting PHI
              safeguards.
            </p>
          </div>
          <label for="notes">Clinical details</label>
          <textarea
            id="notes"
            placeholder="Caller reports chest tightness after shoveling snow..."
            aria-label="Clinical notes input"
          ></textarea>
          <div class="actions">
            <button id="summarize-btn" class="action" onclick="summarize()">
              <span aria-hidden="true">📝</span> Summarize notes
            </button>
            <button id="triage-btn" class="action" onclick="triage()">
              <span aria-hidden="true">📋</span> Generate triage questions
            </button>
          </div>
          <div id="status" class="status" role="status" aria-live="polite"></div>
        </section>

        <section class="panel" aria-labelledby="output-heading">
          <div>
            <h2 id="output-heading">Output</h2>
            <p class="disclaimer">Results render here once a request completes.</p>
          </div>
          <div class="output-box" aria-live="polite">
            <pre id="out" aria-label="Model output"></pre>
            <span id="output-hint" class="empty-hint">No output yet — run a mode to see results.</span>
          </div>
        </section>
      </div>

      <footer class="footer">
        <span>No protected health information is saved by this site.</span>
        <span>Responses intentionally omit any PHI shared in the prompt.</span>
      </footer>
    </div>

    <script>
      const notesEl = document.getElementById("notes");
      const statusEl = document.getElementById("status");
      const outputEl = document.getElementById("out");
      const outputHint = document.getElementById("output-hint");
      const summarizeBtn = document.getElementById("summarize-btn");
      const triageBtn = document.getElementById("triage-btn");
      const themeToggle = document.getElementById("theme-toggle");

      const THEME_STORAGE_KEY = "clinician-helper-theme";

      function setStatus(state, message) {
        if (!message) {
          statusEl.textContent = "";
          statusEl.classList.remove("show");
          statusEl.removeAttribute("data-state");
          statusEl.removeAttribute("data-icon");
          statusEl.innerHTML = "";
          return;
        }

        statusEl.dataset.state = state;
        statusEl.classList.add("show");
        statusEl.innerHTML = "";

        if (state === "waiting") {
          const spinner = document.createElement("span");
          spinner.className = "spinner";
          spinner.setAttribute("aria-hidden", "true");
          statusEl.append(spinner);
        } else if (state === "success") {
          statusEl.insertAdjacentText("beforeend", "✅ ");
        } else if (state === "error") {
          statusEl.insertAdjacentText("beforeend", "⚠️ ");
        }

        const textNode = document.createElement("span");
        textNode.textContent = message;
        statusEl.append(textNode);
      }

      function setOutput(content) {
        outputEl.textContent = content || "";
        outputHint.style.display = content ? "none" : "block";
      }

      function applyTheme(theme) {
        const isDark = theme === "dark";
        document.body.classList.toggle("dark", isDark);
        themeToggle.setAttribute("aria-pressed", String(isDark));
        themeToggle.textContent = isDark ? "☀️ Light mode" : "🌙 Dark mode";
      }

      const storedTheme = localStorage.getItem(THEME_STORAGE_KEY);
      const prefersDark = window.matchMedia("(prefers-color-scheme: dark)");
      let activeTheme = storedTheme || (prefersDark.matches ? "dark" : "light");
      applyTheme(activeTheme);

      themeToggle.addEventListener("click", () => {
        activeTheme = document.body.classList.contains("dark") ? "light" : "dark";
        localStorage.setItem(THEME_STORAGE_KEY, activeTheme);
        applyTheme(activeTheme);
      });

      const handleSystemThemeChange = (event) => {
        if (!localStorage.getItem(THEME_STORAGE_KEY)) {
          activeTheme = event.matches ? "dark" : "light";
          applyTheme(activeTheme);
        }
      };

      if (typeof prefersDark.addEventListener === "function") {
        prefersDark.addEventListener("change", handleSystemThemeChange);
      } else if (typeof prefersDark.addListener === "function") {
        prefersDark.addListener(handleSystemThemeChange);
      }

      async function handleRequest(endpoint, onSuccess) {
        const text = notesEl.value.trim();
        if (!text) {
          setStatus("error", "Please provide some notes first.");
          notesEl.focus();
          return;
        }

        const buttons = [summarizeBtn, triageBtn];
        buttons.forEach((btn) => (btn.disabled = true));
        setStatus("waiting", "Processing request...");
        setOutput("");

        try {
          const res = await fetch(endpoint, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text })
          });
          const json = await res.json();

          if (res.ok) {
            onSuccess(json);
            setStatus("success", "Completed successfully.");
          } else {
            throw new Error(json.detail || "Unknown error");
          }
        } catch (error) {
          console.error(error);
          setStatus("error", error.message || "Something went wrong");
          setOutput(`Error: ${error.message || "Unexpected issue"}`);
        } finally {
          buttons.forEach((btn) => (btn.disabled = false));
        }
      }

      function summarize() {
        handleRequest("/api/summarize", (json) => {
          setOutput(json.summary || "No summary returned.");
        });
      }

      function triage() {
        handleRequest("/api/triage", (json) => {
          const questions = (json.questions || []).map((q, i) => `${i + 1}. ${q}`);
          setOutput(questions.length ? questions.join("\n") : "No questions returned.");
        });
      }
    </script>
  </body>
</html>
